# mov2mp4

このリポジトリは、指定ディレクトリを監視し、`.mov`ファイルを自動で`.mp4`（コンテナのみコピー）に変換するDockerコンテナを構成するサンプルです。

---

## 特徴

* 5秒ごとに監視ディレクトリをスキャン
* ファイル名に含まれる日時（`YYYY-MM-DD HH.MM.SS`形式）を解析し、過去24時間以内の動画のみ処理
* 同名の`.mp4`が存在しない場合のみ変換を実行
* 複数ファイルは古い順に一つずつ処理
* コンテナ自動再起動設定（`unless-stopped`）で運用性向上

---

## ファイル構成

```
├─ Dockerfile
├─ docker-compose.yml
├─ monitor.py       # 監視・変換スクリプト
└─ README.md
```

---

## セットアップ

### 前提

* Docker Engine
* Docker Compose

### ビルド & 起動

1. リポジトリをクローン

   ```bash
   git clone <リポジトリURL>
   cd mov2mp4
   ```
2. 環境変数でホスト側ディレクトリを指定（未設定時は`./videos`）

   ```bash
   export HOST_WATCH_DIR=/path/to/watch
   ```
3. Docker Composeでビルド＆起動

   ```bash
   docker-compose up -d --build
   ```

---

## 環境変数

| 変数               | 説明             | デフォルト      |
| ---------------- | -------------- | ---------- |
| `HOST_WATCH_DIR` | ホスト側の監視ディレクトリ  | `./videos` |
| `WATCH_DIR`      | コンテナ内の監視ディレクトリ | `/watch`   |

---

## 動作例

1. `HOST_WATCH_DIR`に`画面収録 2025-06-17 16.51.35.mov`を配置
2. コンテナが5秒以内に検知し、同名の`.mp4`がなければ変換
3. 出力: `画面収録 2025-06-17 16.51.35.mp4`

---

## 注意事項

* ディレクトリ監視はポーリング方式です（inotify非対応）。
* 大量ファイルを扱う場合はリソースに注意してください。
